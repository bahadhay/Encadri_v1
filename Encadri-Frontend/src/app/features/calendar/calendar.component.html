<div class="calendar-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h2>Calendar</h2>
      <p>View all your meetings, deadlines, and milestones</p>
    </div>
    <div class="header-actions">
      <div class="view-toggle">
        <button class="toggle-btn" [class.active]="viewMode() === 'timeline'" (click)="setViewMode('timeline')">
          <app-icon name="list" [size]="16"></app-icon>
          Timeline
        </button>
        <button class="toggle-btn" [class.active]="viewMode() === 'gantt'" (click)="setViewMode('gantt')">
          <app-icon name="view_timeline" [size]="16"></app-icon>
          Gantt
        </button>
        <button class="toggle-btn" [class.active]="viewMode() === 'calendar'" (click)="setViewMode('calendar')">
          <app-icon name="calendar_view_month" [size]="16"></app-icon>
          Month
        </button>
      </div>
      <app-ui-button variant="outline" (click)="today()" *ngIf="viewMode() === 'calendar'">
        Today
      </app-ui-button>
    </div>
  </div>

  <!-- Timeline View -->
  <div *ngIf="viewMode() === 'timeline'" class="timeline-view">
    <div *ngFor="let monthGroup of timelineEvents()" class="timeline-month">
      <h3 class="month-header">{{ monthGroup.monthYear }}</h3>
      <div class="timeline-events">
        <div *ngFor="let event of monthGroup.events"
             class="timeline-event"
             (click)="selectEvent(event)">
          <div class="event-marker" [style.background-color]="event.color"></div>
          <div class="event-details">
            <div class="event-header-row">
              <app-icon [name]="getEventIcon(event.type)" [size]="18"></app-icon>
              <span class="event-title-text">{{ event.title }}</span>
              <span class="event-type-badge" [style.background-color]="event.color">
                {{ event.type }}
              </span>
            </div>
            <div class="event-meta">
              <span class="event-date">
                <app-icon name="calendar_today" [size]="14"></app-icon>
                {{ formatDate(event.start) }}
              </span>
              <span class="event-time" *ngIf="!event.allDay">
                <app-icon name="schedule" [size]="14"></app-icon>
                {{ formatTime(event.start) }}
              </span>
              <span class="event-location" *ngIf="event.location">
                <app-icon name="location_on" [size]="14"></app-icon>
                {{ event.location }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gantt View -->
  <div *ngIf="viewMode() === 'gantt'" class="gantt-view">
    <div class="gantt-container">
      <div *ngFor="let project of ganttMilestones()" class="gantt-project">
        <h3 class="project-title">Project: {{ project.projectId }}</h3>
        <div class="gantt-timeline">
          <div class="gantt-header">
            <div class="gantt-months">
              <!-- Month markers will be shown based on milestone range -->
            </div>
          </div>
          <div class="gantt-bars">
            <div *ngFor="let milestone of project.milestones" class="gantt-bar-row">
              <div class="milestone-label">{{ milestone.title }}</div>
              <div class="milestone-bar" [style.background-color]="milestone.color">
                <span class="milestone-date">{{ formatDateShort(milestone.start) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar Navigation -->
  <div *ngIf="viewMode() === 'calendar'" class="calendar-nav">
    <button class="nav-btn" (click)="previousMonth()">
      <app-icon name="chevron_left" [size]="20"></app-icon>
    </button>
    <h3 class="current-month">{{ currentMonth() }}</h3>
    <button class="nav-btn" (click)="nextMonth()">
      <app-icon name="chevron_right" [size]="20"></app-icon>
    </button>
  </div>

  <!-- Calendar Grid -->
  <div *ngIf="viewMode() === 'calendar'" class="calendar-grid">
    <!-- Weekday Headers -->
    <div class="weekday-header">Sun</div>
    <div class="weekday-header">Mon</div>
    <div class="weekday-header">Tue</div>
    <div class="weekday-header">Wed</div>
    <div class="weekday-header">Thu</div>
    <div class="weekday-header">Fri</div>
    <div class="weekday-header">Sat</div>

    <!-- Calendar Days -->
    <div *ngFor="let day of calendarDays()"
         class="calendar-day"
         [class.other-month]="!day.isCurrentMonth"
         [class.today]="day.isToday">
      <div class="day-number">{{ day.date.getDate() }}</div>
      <div class="day-events">
        <div *ngFor="let event of day.events.slice(0, 3)"
             class="event-item"
             [style.background-color]="event.color"
             (click)="selectEvent(event)">
          <span class="event-title">{{ event.title }}</span>
          <span class="event-time" *ngIf="!event.allDay">
            {{ formatTime(event.start) }}
          </span>
        </div>
        <div *ngIf="day.events.length > 3" class="more-events">
          +{{ day.events.length - 3 }} more
        </div>
      </div>
    </div>
  </div>

  <!-- Legend -->
  <div *ngIf="viewMode() === 'calendar'" class="calendar-legend">
    <div class="legend-item">
      <div class="legend-color" style="background: #3B82F6;"></div>
      <span>Meetings</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #F97316;"></div>
      <span>Submissions</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: #8B5CF6;"></div>
      <span>Milestones</span>
    </div>
  </div>
</div>

<!-- Event Detail Modal -->
<div class="modal-overlay" *ngIf="selectedEvent()" (click)="closeEventDetail()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title">
        <app-icon [name]="getEventIcon(selectedEvent()!.type)" [size]="24"></app-icon>
        <h3>{{ selectedEvent()!.title }}</h3>
      </div>
      <button class="close-btn" (click)="closeEventDetail()">
        <app-icon name="close" [size]="20"></app-icon>
      </button>
    </div>
    <div class="modal-body">
      <div class="event-detail-section">
        <div class="detail-row">
          <app-icon name="calendar_today" [size]="18"></app-icon>
          <span>{{ formatDate(selectedEvent()!.start) }}</span>
        </div>
        <div class="detail-row" *ngIf="!selectedEvent()!.allDay">
          <app-icon name="schedule" [size]="18"></app-icon>
          <span>{{ formatTime(selectedEvent()!.start) }} - {{ formatTime(selectedEvent()!.end) }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedEvent()!.location">
          <app-icon name="location_on" [size]="18"></app-icon>
          <span>{{ selectedEvent()!.location }}</span>
        </div>
        <div class="detail-row" *ngIf="selectedEvent()!.status">
          <app-icon name="info" [size]="18"></app-icon>
          <span class="status-badge" [class]="selectedEvent()!.status">
            {{ selectedEvent()!.status }}
          </span>
        </div>
      </div>
      <div class="event-description" *ngIf="selectedEvent()!.description">
        <h4>Description</h4>
        <p>{{ selectedEvent()!.description }}</p>
      </div>
    </div>
    <div class="modal-actions">
      <app-ui-button variant="outline" (click)="closeEventDetail()">
        Close
      </app-ui-button>
      <app-ui-button variant="primary" (click)="navigateToEvent(selectedEvent()!)">
        View Details
      </app-ui-button>
    </div>
  </div>
</div>

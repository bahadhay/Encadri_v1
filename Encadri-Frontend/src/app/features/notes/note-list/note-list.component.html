<div class="notes-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h2>Notes</h2>
      <p>Your personal notebook</p>
    </div>
    <div class="header-actions">
      <app-ui-button variant="outline" (click)="isCreateFolderOpen.set(true)">
        <app-icon name="create_new_folder" [size]="16"></app-icon>
        New Folder
      </app-ui-button>
      <app-ui-button variant="primary" routerLink="/notes/new">
        <app-icon name="plus" [size]="16"></app-icon>
        New Note
      </app-ui-button>
    </div>
  </div>

  <!-- Folders -->
  <div class="folders-section" *ngIf="folders().length > 0">
    <div class="folders-list">
      <button
        class="folder-btn"
        [class.active]="!selectedFolder()"
        (click)="selectedFolder.set(null)">
        <app-icon name="folder" [size]="18"></app-icon>
        All Notes
        <span class="folder-count">{{ notes().length }}</span>
      </button>
      <button
        *ngFor="let folder of folders()"
        class="folder-btn"
        [class.active]="selectedFolder()?.id === folder.id"
        (click)="selectedFolder.set(folder)">
        <app-icon name="folder" [size]="18"></app-icon>
        {{ folder.name }}
        <span class="folder-count">{{ getFolderNoteCount(folder.id!) }}</span>
      </button>
    </div>
  </div>

  <!-- Search -->
  <div class="search-box">
    <app-ui-input
      placeholder="Search notes..."
      [ngModel]="searchTerm()"
      (ngModelChange)="searchTerm.set($event)">
    </app-ui-input>
  </div>

  <!-- Loading State -->
  <div class="notes-grid" *ngIf="loading()">
    <app-skeleton-card *ngFor="let i of [1,2,3,4,5,6]"></app-skeleton-card>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading() && filteredNotes().length === 0">
    <div class="empty-icon">üìù</div>
    <h3>{{ searchTerm() ? 'No notes found' : 'No notes yet' }}</h3>
    <p>{{ searchTerm() ? 'Try a different search term' : 'Create your first note to get started' }}</p>
    <app-ui-button variant="primary" routerLink="/notes/new" *ngIf="!searchTerm()">
      Create Note
    </app-ui-button>
  </div>

  <!-- Notes List -->
  <div *ngIf="!loading() && filteredNotes().length > 0">
    <!-- Pinned Notes -->
    <div *ngIf="pinnedNotes().length > 0" class="notes-section">
      <h3 class="section-title">
        <app-icon name="push_pin" [size]="18"></app-icon>
        Pinned
      </h3>
      <div class="notes-grid">
        <app-ui-card *ngFor="let note of pinnedNotes()"
                     [routerLink]="['/notes', note.id]"
                     class="note-card"
                     [ngClass]="getColorClass(note.color)">
          <div class="note-header">
            <h4>{{ note.title }}</h4>
            <div class="note-actions">
              <button class="action-btn pinned" (click)="togglePin(note, $event)" title="Unpin">
                <app-icon name="push_pin" [size]="18"></app-icon>
              </button>
              <button class="action-btn" [routerLink]="['/notes', note.id, 'edit']" (click)="$event.stopPropagation()" title="Edit">
                <app-icon name="edit" [size]="18"></app-icon>
              </button>
              <button class="action-btn danger" (click)="openDeleteDialog(note, $event)" title="Delete">
                <app-icon name="trash" [size]="18"></app-icon>
              </button>
            </div>
          </div>
          <p class="note-preview">{{ note.content.substring(0, 150) }}{{ note.content.length > 150 ? '...' : '' }}</p>
          <div class="note-footer">
            <span class="note-date">{{ formatDate(note.updatedDate) }}</span>
          </div>
        </app-ui-card>
      </div>
    </div>

    <!-- Other Notes -->
    <div *ngIf="unpinnedNotes().length > 0" class="notes-section">
      <h3 class="section-title" *ngIf="pinnedNotes().length > 0">All Notes</h3>
      <div class="notes-grid">
        <app-ui-card *ngFor="let note of unpinnedNotes()"
                     [routerLink]="['/notes', note.id]"
                     class="note-card"
                     [ngClass]="getColorClass(note.color)">
          <div class="note-header">
            <h4>{{ note.title }}</h4>
            <div class="note-actions">
              <button class="action-btn" (click)="togglePin(note, $event)" title="Pin">
                <app-icon name="push_pin" [size]="18"></app-icon>
              </button>
              <button class="action-btn" [routerLink]="['/notes', note.id, 'edit']" (click)="$event.stopPropagation()" title="Edit">
                <app-icon name="edit" [size]="18"></app-icon>
              </button>
              <button class="action-btn danger" (click)="openDeleteDialog(note, $event)" title="Delete">
                <app-icon name="trash" [size]="18"></app-icon>
              </button>
            </div>
          </div>
          <p class="note-preview">{{ note.content.substring(0, 150) }}{{ note.content.length > 150 ? '...' : '' }}</p>
          <div class="note-footer">
            <span class="note-date">{{ formatDate(note.updatedDate) }}</span>
          </div>
        </app-ui-card>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Dialog -->
<app-confirm-dialog
  [isOpen]="isDeleteDialogOpen()"
  title="Delete Note"
  [message]="deleteMessage()"
  confirmText="Delete"
  variant="danger"
  [loading]="deleting()"
  (confirm)="confirmDelete()"
  (cancel)="isDeleteDialogOpen.set(false)">
</app-confirm-dialog>

<!-- Create Folder Dialog -->
<app-confirm-dialog
  [isOpen]="isCreateFolderOpen()"
  title="Create Folder"
  message="Enter folder name:"
  confirmText="Create"
  variant="info"
  [loading]="creatingFolder()"
  (confirm)="createFolder()"
  (cancel)="cancelCreateFolder()">
  <div style="margin-top: 1rem;">
    <app-ui-input
      placeholder="Folder name..."
      [(ngModel)]="newFolderName"
      name="folderName">
    </app-ui-input>
  </div>
</app-confirm-dialog>

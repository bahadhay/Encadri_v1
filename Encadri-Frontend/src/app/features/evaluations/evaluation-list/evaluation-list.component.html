<div class="evaluations-container">
  <div class="loading-state" *ngIf="loading()">
    <div class="spinner"></div>
    <p>Loading evaluations...</p>
  </div>

  <div class="empty-state" *ngIf="!loading() && evaluations().length === 0">
    <div class="empty-icon">ðŸ“Š</div>
    <h3>No evaluations yet</h3>
    <p>Evaluations and grades will appear here.</p>
    <app-ui-button variant="primary" (click)="openCreateModal()">
      + Add Evaluation
    </app-ui-button>
  </div>

  <div class="evaluations-list" *ngIf="!loading() && evaluations().length > 0">
    <app-ui-card *ngFor="let evaluation of evaluations()">
      <div class="evaluation-detail-header">
        <app-ui-button size="sm" variant="outline" [routerLink]="['/projects', projectId, 'evaluations', evaluation.id, 'edit']">
          Edit Evaluation
        </app-ui-button>
      </div>
      <div class="evaluation-card">
        <div class="grade-box">
          <span class="grade">{{ evaluation.finalGrade }}</span>
          <span class="max-grade">/ 20</span>
        </div>
        
        <div class="card-content">
          <div class="content-header">
            <h3>Final Evaluation</h3>
            <span class="date">{{ evaluation.createdDate | date:'mediumDate' }}</span>
          </div>
          
          <div class="scores-grid">
            <div class="score-item">
              <div class="score-header">
                <span class="label">Report Quality</span>
                <span class="value">{{ evaluation.reportQualityScore }}/5</span>
              </div>
              <div class="progress-track">
                <div class="progress-fill" [style.width.%]="((evaluation.reportQualityScore || 0) / 5) * 100"></div>
              </div>
            </div>
            <div class="score-item">
              <div class="score-header">
                <span class="label">Tech Implementation</span>
                <span class="value">{{ evaluation.technicalImplementationScore }}/5</span>
              </div>
              <div class="progress-track">
                <div class="progress-fill" [style.width.%]="((evaluation.technicalImplementationScore || 0) / 5) * 100"></div>
              </div>
            </div>
            <div class="score-item">
              <div class="score-header">
                <span class="label">Presentation</span>
                <span class="value">{{ evaluation.presentationScore }}/5</span>
              </div>
              <div class="progress-track">
                <div class="progress-fill" [style.width.%]="((evaluation.presentationScore || 0) / 5) * 100"></div>
              </div>
            </div>
             <div class="score-item">
              <div class="score-header">
                <span class="label">Professionalism</span>
                <span class="value">{{ evaluation.professionalConductScore }}/5</span>
              </div>
              <div class="progress-track">
                <div class="progress-fill" [style.width.%]="((evaluation.professionalConductScore || 0) / 5) * 100"></div>
              </div>
            </div>
          </div>

          <p class="comments" *ngIf="evaluation.comments">"{{ evaluation.comments }}"</p>
          <p class="evaluator" *ngIf="evaluation.evaluatorName">Evaluated by: {{ evaluation.evaluatorName }}</p>
        </div>
      </div>
    </app-ui-card>
  </div>
</div>

<!-- Evaluation Modal -->
<app-modal
  [isOpen]="isModalOpen()"
  title="Submit Evaluation"
  size="large"
  (close)="closeModal()">

  <form (ngSubmit)="onSubmit()">
    <div class="form-grid">
      <div class="form-group">
        <div class="label-row">
          <label class="label">Report Quality</label>
          <span class="value-display">{{ evaluation.reportQualityScore }}/5</span>
        </div>
        <input
          type="range"
          min="0" max="5"
          step="0.5"
          class="range-input"
          [(ngModel)]="evaluation.reportQualityScore"
          (ngModelChange)="calculateGrade()"
          name="reportQualityScore"
          [disabled]="formLoading()">
      </div>

      <div class="form-group">
        <div class="label-row">
          <label class="label">Technical Implementation</label>
          <span class="value-display">{{ evaluation.technicalImplementationScore }}/5</span>
        </div>
        <input
          type="range"
          min="0" max="5"
          step="0.5"
          class="range-input"
          [(ngModel)]="evaluation.technicalImplementationScore"
          (ngModelChange)="calculateGrade()"
          name="technicalImplementationScore"
          [disabled]="formLoading()">
      </div>

      <div class="form-group">
        <div class="label-row">
          <label class="label">Presentation</label>
          <span class="value-display">{{ evaluation.presentationScore }}/5</span>
        </div>
        <input
          type="range"
          min="0" max="5"
          step="0.5"
          class="range-input"
          [(ngModel)]="evaluation.presentationScore"
          (ngModelChange)="calculateGrade()"
          name="presentationScore"
          [disabled]="formLoading()">
      </div>

      <div class="form-group">
        <div class="label-row">
          <label class="label">Professional Conduct</label>
          <span class="value-display">{{ evaluation.professionalConductScore }}/5</span>
        </div>
        <input
          type="range"
          min="0" max="5"
          step="0.5"
          class="range-input"
          [(ngModel)]="evaluation.professionalConductScore"
          (ngModelChange)="calculateGrade()"
          name="professionalConductScore"
          [disabled]="formLoading()">
      </div>

      <div class="form-group">
        <label class="label">Defense Date</label>
        <input
          type="date"
          class="native-input"
          [(ngModel)]="evaluation.defenseDate"
          name="defenseDate"
          [disabled]="formLoading()">
      </div>

      <div class="form-group full-width grade-display">
        <label class="label">Total Grade: </label>
        <span class="total-grade">{{ evaluation.finalGrade }} / 20</span>
      </div>

      <div class="form-group full-width">
        <label class="label">Comments</label>
        <textarea
          class="textarea"
          [(ngModel)]="evaluation.comments"
          name="comments"
          rows="4"
          placeholder="Feedback for the student..."
          [disabled]="formLoading()">
        </textarea>
      </div>
    </div>

    <div *ngIf="formError()" class="error-banner">
      {{ formError() }}
    </div>

    <div class="modal-actions">
      <app-ui-button type="button" variant="outline" (click)="closeModal()" [disabled]="formLoading()">
        Cancel
      </app-ui-button>
      <app-ui-button type="submit" variant="primary" [loading]="formLoading()">
        Submit Evaluation
      </app-ui-button>
    </div>
  </form>
</app-modal>

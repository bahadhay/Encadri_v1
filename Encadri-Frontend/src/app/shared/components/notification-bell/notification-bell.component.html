<div class="notification-bell-container">
  <!-- Bell Icon with Badge -->
  <button
    class="bell-button"
    (click)="toggleDropdown()"
    [class.has-unread]="notificationService.unreadCount() > 0"
    title="Notifications">
    <svg class="bell-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>

    <!-- Unread Badge -->
    <span class="unread-badge" *ngIf="notificationService.unreadCount() > 0">
      {{ notificationService.unreadCount() > 99 ? '99+' : notificationService.unreadCount() }}
    </span>
  </button>

  <!-- Dropdown Menu -->
  <div class="notification-dropdown" *ngIf="isDropdownOpen">
    <!-- Header -->
    <div class="dropdown-header">
      <h3>Notifications</h3>
      <button
        class="mark-all-read-btn"
        (click)="markAllAsRead()"
        *ngIf="notificationService.unreadCount() > 0">
        Mark all as read
      </button>
    </div>

    <!-- Notifications List -->
    <div class="notifications-list">
      <div
        *ngFor="let notification of notificationService.notifications()"
        class="notification-item"
        [class.unread]="!notification.isRead"
        [class]="getPriorityClass(notification.priority)"
        (click)="onNotificationClick(notification)">

        <div class="notification-icon">
          {{ getNotificationIcon(notification.type) }}
        </div>

        <div class="notification-content">
          <div class="notification-title">
            {{ notification.title }}
          </div>
          <div class="notification-message">
            {{ notification.message }}
          </div>
          <div class="notification-time">
            {{ formatTime(notification.createdDate) }}
          </div>

          <!-- Accept/Decline buttons for invitations -->
          <div class="invitation-actions" *ngIf="notification.type === 'invitation' && !notification.isRead">
            <button class="accept-btn" (click)="acceptInvitation($event, notification)">
              ✓ Accept
            </button>
            <button class="decline-btn" (click)="declineInvitation($event, notification)">
              ✗ Decline
            </button>
          </div>
        </div>

        <div class="notification-actions">
          <button
            class="delete-btn"
            (click)="deleteNotification($event, notification.id)"
            title="Delete">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
              <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="unread-indicator" *ngIf="!notification.isRead"></div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="notificationService.notifications().length === 0">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M13.73 21a2 2 0 0 1-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <p>No notifications</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="dropdown-footer">
      <a href="/notifications" class="view-all-link">View all notifications</a>
    </div>
  </div>

  <!-- Overlay to close dropdown -->
  <div
    class="dropdown-overlay"
    *ngIf="isDropdownOpen"
    (click)="closeDropdown()">
  </div>
</div>
